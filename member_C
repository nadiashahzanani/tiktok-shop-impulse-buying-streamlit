import streamlit as st
import pandas as pd
import plotly.express as px
import seaborn as sns
import matplotlib.pyplot as plt
import numpy as np

def app():
    st.header("Member C — Sub-Objective 3: Examine Trust, Enjoyment & Shopping Motivation On TikTok Shop Analysis")

    # Load dataset
    df = pd.read_excel("tiktok_impulse_data_responses.xlsx")

    # Define factor groups
    trust_items = [
        'trust_no_risk', 'trust_reliable', 'trust_variety_meets_needs',
        'trust_sells_honestly', 'trust_quality_matches_description'
    ]
    motivation_items = ['relax_reduce_stress', 'motivated_by_discount_promo', 'motivated_by_gifts']

    # Create composite scores
    df['Trust_Score'] = df[trust_items].mean(axis=1)
    df['Motivation_Score'] = df[motivation_items].mean(axis=1)

    # Sidebar filters
    st.sidebar.header("Filter Respondents")
    gender_filter = st.sidebar.multiselect("Gender", df['gender'].unique(), df['gender'].unique())
    filtered_df = df[df['gender'].isin(gender_filter)]

    # 1️⃣ Correlation Heatmap
    st.subheader("Correlation Between Trust & Motivation Items")
    corr_items = filtered_df[trust_items + motivation_items].corr()
    fig = px.imshow(corr_items, text_auto=True, color_continuous_scale='RdBu_r')
    st.plotly_chart(fig)

    st.write("""
    **Interpretation:**  
    The analysis shows a moderate positive relationship between trust and motivation. 
    Higher trust scores are associated with increased motivation to shop, confirming that psychological factors influence impulse buying behavior on TikTok Shop.
    """)

    # 2️⃣ Bar chart: Trust item means
    st.subheader("Trust Item Scores")
    trust_means = filtered_df[trust_items].mean()
    fig2 = px.bar(trust_means, x=trust_means.index, y=trust_means.values, labels={'x':'Item','y':'Mean Score'})
    st.plotly_chart(fig2)

    st.write("""
    **Interpretation:**  
    The analysis shows a moderate positive relationship between trust and motivation. 
    Higher trust scores are associated with increased motivation to shop, confirming that psychological factors influence impulse buying behavior on TikTok Shop.
    """)

    # 3️⃣ Bar chart: Motivation item means
    st.subheader("Motivation Item Scores")
    mot_means = filtered_df[motivation_items].mean()
    fig3 = px.bar(mot_means, x=mot_means.index, y=mot_means.values, labels={'x':'Item','y':'Mean Score'})
    st.plotly_chart(fig3)

    st.write("""
    **Interpretation:**  
    The analysis shows a moderate positive relationship between trust and motivation. 
    Higher trust scores are associated with increased motivation to shop, confirming that psychological factors influence impulse buying behavior on TikTok Shop.
    """)

    # 4️⃣ Scatter Plot: Trust vs Motivation
    st.subheader("Trust vs Motivation")
    fig4 = px.scatter(filtered_df, x='Trust_Score', y='Motivation_Score', trendline='ols')
    st.plotly_chart(fig4)

    st.write("""
    **Interpretation:**  
    The analysis shows a moderate positive relationship between trust and motivation. 
    Higher trust scores are associated with increased motivation to shop, confirming that psychological factors influence impulse buying behavior on TikTok Shop.
    """)

    # 5️⃣ Radar Chart: Trust Dimensions
    st.subheader("Trust Dimension Radar Chart")
    labels = trust_items
    values = trust_means.values.tolist()
    values += values[:1]
    angles = np.linspace(0, 2*np.pi, len(labels)+1)

    st.write("""
    **Interpretation:**  
    The analysis shows a moderate positive relationship between trust and motivation. 
    Higher trust scores are associated with increased motivation to shop, confirming that psychological factors influence impulse buying behavior on TikTok Shop.
    """)

    fig5, ax = plt.subplots(figsize=(6,6), subplot_kw=dict(polar=True))
    ax.plot(angles, values, 'o-', linewidth=2)
    ax.fill(angles, values, alpha=0.25)
    ax.set_thetagrids(angles[:-1] * 180/np.pi, labels)
    st.pyplot(fig5)
